<!DOCTYPE html>
<html>

<head>
    <title>User Management</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
        }

        .btn {
            padding: 10px 20px;
            background: #4285F4;
            color: white;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #357ae8;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>Milestone 1: Data Ingestion</h2>
        <p>Select an Excel file (.xlsx) with columns: Name, DOB, Email, Password, Phone, Gender, Address</p>

        <input type="password" id="adminKey" placeholder="Enter Admin Secret Key"
            style="padding: 8px; margin-right: 10px;" />
        <input type="file" id="excelFile" accept=".xlsx" />
        <button class="btn" onclick="uploadFile()">Upload Data</button>
        <button onclick="window.location.href='login.html'" class="btn">Login</button>
        <p id="status"></p>
    </div>

    <script>
        async function uploadFile() {
            const adminKey = document.getElementById('adminKey').value;
            const fileInput = document.getElementById('excelFile');
            const status = document.getElementById('status');

            if (fileInput.files.length === 0) {
                alert("Please select a file!");
                return;
            }

            // Simple validation on client side
            if (!adminKey) {
                alert("Please enter the Admin Key to proceed.");
                return;
            }

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            status.innerText = "Uploading...";

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'X-Admin-Key': adminKey
                    },
                    body: formData
                });

                const text = await response.text();
                if (response.ok) {
                    status.innerText = text;
                    status.style.color = "green";
                } else {
                    status.innerText = "Error: " + text; // This will show "Access Denied" if key is wrong
                    status.style.color = "red";
                }
            } catch (error) {
                status.innerText = "Error uploading file: " + error;
                status.style.color = "red";
            }
        }
    </script>
</body>

</html>